<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>글 작성</title>
  <link rel="stylesheet" href="write.css" />
</head>
<body>
  <div class="container">
    <h1>새 글 작성</h1>

    <select id="category" name="category" required>
      <option value="default">일반</option>
      <option value="quest">질문</option>
      <option value="info">정보</option>
      <option value="notice">공지</option>
    </select>

    <form id="postForm">
      <input
        type="text"
        id="author"
        name="author"
        class="auth-only"
        placeholder="닉네임"
        style="width: 150px; display: none;"
      /><br />

      <input type="password" id="password" placeholder="비밀번호" class="non-auth-only" required /><br />

      <input type="text" id="title" name="title" placeholder="제목" required /><br />

      <div class="format-toolbar">
        <button type="button" onclick="insertFormat('**', '**')"><b>굵게</b></button>
        <button type="button" onclick="insertFormat('__', '__')"><u>밑줄</u></button>
        <button type="button" onclick="insertFormat('~~', '~~')"><s>취소선</s></button>
        <button type="button" onclick="insertFormat('\\n', '')">줄바꿈</button>
      </div>

      <!-- 본문 입력 영역: contenteditable div -->
      <div
        id="content"
        name="content"
        contenteditable="true"
        spellcheck="true"
        aria-multiline="true"
        role="textbox"
        style="width: 100%; min-height: 200px; border: 1px solid #ccc; padding: 10px; overflow-y: auto;"
        required
      ></div>

      <input type="file" id="image" name="images" multiple accept="image/*" /><br />

      <button type="submit">작성 완료</button>
    </form>

    <a class="back" href="index.html">← 목록으로</a>
  </div>

  <script>
    // 서식 버튼 클릭 시 동작: contenteditable 영역에 스타일 적용
    function insertFormat(startTag, endTag) {
      const contentDiv = document.getElementById('content');
      const sel = window.getSelection();
      if (!sel || sel.rangeCount === 0) return;

      const range = sel.getRangeAt(0);
      if (startTag === '\\n') {
        const br = document.createElement('br');
        range.deleteContents();
        range.insertNode(br);
        range.setStartAfter(br);
        range.setEndAfter(br);
        sel.removeAllRanges();
        sel.addRange(range);
        contentDiv.focus();
        return;
      }

      const wrapper = document.createElement('span');
      switch (startTag) {
        case '**':
          wrapper.style.fontWeight = 'bold';
          break;
        case '__':
          wrapper.style.textDecoration = 'underline';
          break;
        case '~~':
          wrapper.style.textDecoration = 'line-through';
          break;
      }

      if (!sel.isCollapsed) {
        const selectedContent = range.extractContents();
        wrapper.appendChild(selectedContent);
        range.insertNode(wrapper);

        range.selectNode(wrapper);
        sel.removeAllRanges();
        sel.addRange(range);
      } else {
        range.insertNode(wrapper);
        sel.removeAllRanges();

        const newRange = document.createRange();
        newRange.selectNodeContents(wrapper);
        newRange.collapse(true);
        sel.addRange(newRange);
      }

      contentDiv.focus();
    }
  </script>

  <script src="write.js"></script>
</body>
</html>
